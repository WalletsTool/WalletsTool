# DevPilot - AI驱动的全生命周期开发平台

## 一、项目概述

### 1.1 项目定位

**DevPilot** 是一个本地运行的通用AI开发助手系统，专注于端到端从需求到可交付软件产品的全流程自动化。

**核心理念**：
- 🤖 AI自主运行，人类只需三个简单界面交互
- 🏠 纯本地运行，数据不出机器
- 🌍 通用架构，支持任何编程语言和框架
- 📦 开源社区共建（GitHub Public）

### 1.2 对标产品

| 产品 | 定位 | DevPilot差异化 |
|------|------|----------------|
| OpenClaw | 本地AI助手 | 专注**完整软件交付**，不仅是聊天 |
| GitHub Copilot | 代码补全 | 端到端**需求→产品**全流程 |
| Cursor | AI IDE | 通用**多语言多项目**支持，本地运行 |
| Devin | AI程序员 | **完全本地化**，用户完全掌控 |

### 1.3 用户价值

| 用户痛点 | DevPilot解决方案 |
|----------|------------------|
| 从需求到代码周期长 | AI自动解析需求、生成代码、编写测试、构建部署 |
| 多项目并行管理混乱 | 统一看板，多项目并行AI处理 |
| 技术选型耗时 | 智能推荐最佳框架和技术栈 |
| 发布流程繁琐 | 一键生成交付物（安装包/Docker镜像） |
| 测试覆盖不全 | AI自动生成单元测试、集成测试 |

---

## 二、核心架构

### 2.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         DevPilot System                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                  🎨 Electron Desktop UI (Vue 3)                 │   │
│  │                                                                 │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐     │   │
│  │  │  📊 看板    │  │  📈 进度    │  │  🎁 产品体验         │     │   │
│  │  │ Dashboard  │  │ Progress   │  │  Preview             │     │   │
│  │  │             │  │             │  │                     │     │   │
│  │  │ • 任务列表  │  │ • 实时状态  │  │ • 可运行产品展示    │     │   │
│  │  │ • 任务微调  │  │ • 里程碑    │  │ • 在线预览/安装包   │     │   │
│  │  │ • 优先级    │  │ • 风险预警  │  │ • 质量报告         │     │   │
│  │  │ • 手动创建  │  │ • 时间线    │  │ • 下载交付物        │     │   │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                            │ IPC通信                                    │
│                            ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │              ⚙️ Core Engine (Node.js)                           │   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │                   任务调度层 (Task Scheduler)            │   │   │
│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │   │
│  │  │  │ 需求解析器 │ │ 任务分解器 │ │ 队列管理器 │ │ 依赖分析器 │   │   │   │
│  │  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │                   AI智能引擎层 (AI Core)                 │   │   │
│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │   │
│  │  │  │ 代码生成器 │ │ 测试生成器 │ │ 代码审查器 │ │ 自动修复  │   │   │   │
│  │  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │   │
│  │  │                                                         │   │   │
│  │  │  ┌──────────────────────────────────────────────────┐  │   │   │
│  │  │  │              LLM引擎 (可插拔适配器)               │  │   │   │
│  │  │  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐    │  │   │   │
│  │  │  │  │ OpenAI │ │Claude │ │ Ollama │ │ 自定义 │    │  │   │   │
│  │  │  │  └────────┘ └────────┘ └────────┘ └────────┘    │  │   │   │
│  │  │  └──────────────────────────────────────────────────┘  │   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │                   执行引擎层 (Executor)                  │   │   │
│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │   │
│  │  │  │ 代码执行器 │ │ 构建系统  │ │ 测试运行器 │ │ 部署引擎  │   │   │   │
│  │  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │                                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                            │                                            │
│                            ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │              🔌 外部集成层 (可配置适配器)                         │   │
│  │                                                                 │   │
│  │  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────────────────┐   │   │
│  │  │ GitHub │  │ GitLab │  │  Jira  │  │ 飞书/企微/钉钉       │   │   │
│  │  └────────┘  └────────┘  └────────┘  └────────────────────┘   │   │
│  │                                                                 │   │
│  │  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────────────────┐   │   │
│  │  │ Docker │  │  NPM   │  │ PyPI   │  │ Maven Central      │   │   │
│  │  └────────┘  └────────┘  └────────┘  └────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 技术栈选型

| 层级 | 技术选型 | 理由 |
|------|----------|------|
| **桌面框架** | Electron 32+ | 成熟稳定，跨平台，生态丰富 |
| **前端框架** | Vue 3.5 + Composition API | 开发效率高，学习成本低 |
| **构建工具** | Vite 7 | 极速冷启动，热更新快 |
| **状态管理** | Pinia 3.0 | 轻量简洁，TypeScript友好 |
| **UI组件库** | Arco Design Vue 2.57 | 现代化设计，组件丰富 |
| **任务调度** | BullMQ (Node.js) | 专业任务队列，支持优先级、延迟、重试 |
| **AI引擎** | LLM API + 本地Ollama | 灵活切换，云端本地都支持 |
| **代码执行** | 原生执行 + Docker沙箱 | 信任代码直接运行，不信任代码沙箱隔离 |
| **数据库** | SQLite (better-sqlite3) | 轻量、无需服务、本地存储 |
| **包管理** | PNPM | 速度快、磁盘占用小、monorepo友好 |
| **编程语言** | TypeScript 5.x | 类型安全，AI友好 |
| **许可证** | Apache 2.0 | 商业友好，开源友好 |

---

## 三、三大交互界面详细设计

### 3.1 📊 看板界面 (Dashboard)

**设计理念**：极简任务管理，AI自主执行，人类仅微调

#### 界面布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│  DevPilot 🚀                                              ⚙️ 设置 | ? 帮助 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 📋 任务看板                                                          │ │
│  │                                                                      │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐│ │
│  │  │   待处理     │  │   进行中     │  │   待审核     │  │   已完成     ││ │
│  │  │  Pending    │  │ In Progress │  │ Awaiting    │  │   Done      ││ │
│  │  │             │  │              │  │   Review    │  │             ││ │
│  │  │     [3]     │  │     [2]      │  │     [1]     │  │    [15]     ││ │
│  │  │             │  │              │  │              │  │             ││ │
│  │  │ • 用户认证   │  │ • API设计    │  │ • 前端重构   │  │ • 数据库设计 ││ │
│  │  │ • 支付模块   │  │ • 权限系统    │  │              │  │ • 用户模块   ││ │
│  │  │ • 消息推送   │  │              │  │              │  │ • 日志系统   ││ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘│ │
│  │                                                                      │ │
│  │  [+ 新建任务]  [📥 导入需求]  [🔗 关联Issue]                        │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 📊 项目概览                                                          │ │
│  │                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────┐   │ │
│  │  │ 项目名称    │ MyProject    │ 语言    │ TypeScript + Vue 3 │   │ │
│  │  │─────────────┼────────────────────────────────────────────────│   │ │
│  │  │ 项目路径    │ D:\projects\my-project                         │   │ │
│  │  │─────────────┼────────────────────────────────────────────────│   │ │
│  │  │ 当前状态    │ 🟢 活跃      │ 进度    │ 45%               │   │ │
│  │  └─────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  │  📈 统计: 任务 21  │  已完成 15  │  进行中 2  │  待处理 3  │  失败 1 │ │
│  │  🧪 测试覆盖率: 78%   │  🏗️ 构建状态: ✅ 通过   │  ⏰ 预计剩余: 3小时 │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 任务卡片交互

```
┌─────────────────────────────────────────────────────────────────┐
│  任务卡片示例                                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 🎯 [P0] 用户认证模块开发                                  │   │
│  │                                                          │   │
│  │  📝 描述: 实现基于JWT注册、登录、的用户认证系统，支持    │   │
│  │      令牌刷新、密码重置等功能                            │   │
│  │                                                          │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │ 🏷️ 标签:  后端  │  安全  │  API  │  高优先级    │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │                                                          │   │
│  │  📊 进度: ████████████░░░░░░░░░░░░░░░  60%             │   │
│  │  ⏱️ 预计: 2小时    │    🕐 创建: 2小时前                  │   │
│  │                                                          │   │
│  │  💬 AI建议: "建议使用bcrypt加密密码，JWT过期时间设为    │   │
│  │             30分钟，支持令牌刷新机制"                    │   │
│  │                                                          │   │
│  │  ─────────────────────────────────────────────────────   │   │
│  │  [⚙️ 微调]  [▶️ 立即执行]  [⏸️ 暂停]  [🗑️ 删除]          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 微调面板

```
┌─────────────────────────────────────────────────────────────────┐
│  任务微调面板                                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📝 基本信息                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 任务名称: [____________________________________]         │   │
│  │                                                          │   │
│  │ 任务类型: [代码生成 ▼]  [测试生成 ▼]  [重构 ▼]           │   │
│  │                                                          │   │
│  │ 优先级:    (●) 高  ( ) 中  ( ) 低                        │   │
│  │                                                          │   │
│  │ 描述:      [____________________________________]        │   │
│  │           [多行文本区域，支持自然语言描述]                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│  🔧 技术约束                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 编程语言:  [Python ▼]  [Java ▼]  [Vue ▼]  [+ 添加]      │   │
│  │                                                          │   │
│  │ 框架要求:  [FastAPI ▼]  [Spring Boot ▼]  [Vite ▼]       │   │
│  │                                                          │   │
│  │ 数据库:    [PostgreSQL ▼]  [MySQL ▼]  [SQLite ▼]        │   │
│  │                                                          │   │
│  │ 代码规范:  [ESLint ▼]  [Prettier ▼]  [Pylint ▼]         │   │
│  │                                                          │   │
│  │ 特殊要求:  [____________________________________]        │   │
│  │           "如：必须使用TypeScript、禁用console.log"      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│  🤖 AI行为配置                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 代码风格:  (●) AI自决  ( ) 遵循项目现有风格  ( ) 强制约束 │   │
│  │                                                          │   │
│  │ 测试覆盖:  (●) 全部  ( ) 核心模块  ( ) 仅关键路径        │   │
│  │                                                          │   │
│  │ 文档生成:  [☑] 生成API文档  [☑] 生成README  [ ] 仅注释 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ─────────────────────────────────────────────────────────────  │
│                         [💾 保存]  [❌ 取消]                     │
└─────────────────────────────────────────────────────────────────┘
```

---

### 3.2 📈 进度界面 (Progress)

**设计理念**：实时透明，AI执行过程一目了然，风险提前预警

#### 界面布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│  执行进度 📈                                             🔍 实时监控    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 🏁 里程碑进度                                                         │ │
│  │                                                                      │ │
│  │  需求分析     ████████████████████░░░░░░░░░  80%                    │ │
│  │  架构设计     ██████████████░░░░░░░░░░░░░░░  60%                    │ │
│  │  代码开发     ██████████████████░░░░░░░░░░  75%  ← 当前阶段          │ │
│  │  测试编写     ████████░░░░░░░░░░░░░░░░░░░░░  40%                    │ │
│  │  构建部署     ██░░░░░░░░░░░░░░░░░░░░░░░░░░  10%                    │ │
│  │                                                                      │ │
│  │  📅 当前里程碑: 代码开发 - 预计完成: 1小时30分钟                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ ⚡ 实时执行状态                                                        │ │
│  │                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────┐   │ │
│  │  │ [🟢] 运行中: 代码生成 (task-123)                             │   │ │
│  │  │       └─ 阶段: 生成用户认证模块                               │   │
│  │  │       └─ 进度: 3/5 文件生成完成                              │   │
│  │  │       └─ 当前: auth.service.ts                              │   │
│  │  └─────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────┐   │ │
│  │  │ [🟡] 队列中: 测试生成 (task-124)                             │   │ │
│  │  │       └─ 等待: task-123 完成 (预计 5分钟)                    │   │
│  │  └─────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────┐   │ │
│  │  │ [🔴] 失败: 数据库设计 (task-120)                             │   │
│  │  │       └─ 原因: 表结构冲突 - users表与existing重复            │   │
│  │  │       └─ AI建议: 重命名表为user_accounts 或 复用现有表        │   │
│  │  │       └─ 操作: [🤖 AI自动修复]  [👀 人工审核]                │   │
│  │  └─────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 📜 执行日志 (实时滚动)                                                │ │
│  │                                                                      │ │
│  │  14:23:01 [INFO] 任务队列初始化完成                                  │ │
│  │  14:23:02 [INFO] 开始解析需求文档                                    │ │
│  │  14:23:05 [INFO] 需求分析完成，提取5个功能点                         │ │
│  │  14:23:06 [INFO] 开始生成代码结构                                    │ │
│  │  14:23:07 [INFO] 创建项目目录结构                                    │ │
│  │  14:23:08 [INFO] 生成配置: package.json, tsconfig.json              │ │
│  │  14:23:10 [INFO] 开始生成用户认证模块                                │ │
│  │  14:23:15 [INFO] 生成完成: src/models/user.ts                       │ │
│  │  14:23:18 [INFO] 生成完成: src/controllers/auth.ts                  │ │
│  │  14:23:22 [INFO] 生成完成: src/services/auth.service.ts             │ │
│  │  14:23:25 [INFO] 🔄 执行代码审查...                                  │ │
│  │  14:23:28 [WARN] 建议: 添加速率限制防止暴力破解                       │ │
│  │  14:23:30 [INFO] 生成完成: src/middleware/rateLimit.ts              │ │
│  │  ...                                                                  │ │
│  │                                                                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ ⚠️ 风险预警                                                          │ │
│  │                                                                      │ │
│  │  🚨 高风险: 1项                                                      │ │
│  │     • 数据库设计失败需要人工干预                                     │ │
│  │                                                                      │ │
│  │  ⚠️ 中风险: 2项                                                      │ │
│  │     • 测试覆盖率低于目标 (当前65%, 目标80%)                          │ │
│  │     • 构建时间过长 (预计超过10分钟)                                  │ │
│  │                                                                      │ │
│  │  ─────────────────────────────────────────────────────────────────   │ │
│  │        [⏸️ 暂停全部任务]  [▶️ 继续全部任务]  [🔄 重试失败任务]        │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 任务详情面板

```
┌─────────────────────────────────────────────────────────────────────────┐
│  任务详情 - task-123 (代码生成)                                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  📋 基本信息                                                              │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ 任务ID:     task-123          状态: 🟢 运行中                      │ │
│  │────────────┼──────────────────────────────────────────────────────│ │
│  │ 任务类型:   代码生成            创建时间: 14:20                    │ │
│  │────────────┼──────────────────────────────────────────────────────│ │
│  │ 优先级:     P0 (高)            开始时间: 14:22                     │ │
│  │────────────┼──────────────────────────────────────────────────────│ │
│  │ 预计剩余:   5分钟              所属项目: MyProject                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  📝 需求描述                                                              │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ "实现基于JWT的用户认证系统，包括：                                 │ │
│  │  1. 用户注册（邮箱验证）                                           │ │
│  │  2. 用户登录（返回JWT Token）                                      │ │
│  │  3. Token刷新机制                                                  │ │
│  │  4. 密码重置（邮件发送）                                           │ │
│  │  5. 权限中间件"                                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  📊 执行进度                                                              │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ 阶段                状态      进度        时间                     │ │
│  │ ────────────────────────────────────────────────────────────────  │ │
│  │ 需求分析            ✅ 完成   100%       14:22-14:23              │ │
│  │ 架构设计            ✅ 完成   100%       14:23-14:25              │ │
│  │ 代码生成            🔄 进行   60%        14:25-进行中              │ │
│  │   - user.ts         ✅ 完成   100%       14:25-14:27              │ │
│  │   - auth.ts         ✅ 完成   100%       14:27-14:28              │ │
│  │   - auth.service.ts 🔄 进行   40%        14:28-进行中              │ │
│  │   - rateLimit.ts    ⏳ 等待   0%         预计2分钟                 │ │
│  │   - refresh.ts      ⏳ 等待   0%         -                         │ │
│  │ 代码审查            ⏳ 等待   0%         -                         │ │
│  │ 测试生成            ⏳ 等待   0%         -                         │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  📁 生成文件                                                              │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ ✅ src/models/user.ts         45 行     14:27                     │ │
│  │ ✅ src/controllers/auth.ts    120 行    14:28                     │ │
│  │ 🔄 src/services/auth.service.ts         生成中...                 │ │
│  │ ⏳ src/middleware/rateLimit.ts          等待中...                 │ │
│  │ ⏳ src/middleware/auth.ts               等待中...                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ──────────────────────────────────────────────────────────────────────  │
│              [⏸️ 暂停]  [▶️ 继续]  [🔄 重试]  [🗑️ 取消]                  │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 3.3 🎁 产品体验界面 (Preview)

**设计理念**：所见即所得，完整产品交付，所见即可用

#### 界面布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│  产品体验 🎁                                           📦 下载 | 🔗 预览 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 📱 产品预览区                                                        │ │
│  │                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────┐   │ │
│  │  │                                                             │   │ │
│  │  │                    🌐 Web应用预览                            │   │ │
│  │  │                                                             │   │ │
│  │  │         ┌───────────────────────────────────────────┐       │   │ │
│  │  │         │                                           │       │   │ │
│  │  │         │         [可交互的Web应用预览区域]           │       │   │ │
│  │  │         │                                           │       │   │ │
│  │  │         │         支持完整的功能交互测试              │       │   │ │
│  │  │         │                                           │       │   │ │
│  │  │         │         桌面应用 → 通过安装包运行          │       │   │ │
│  │  │         │         Web应用 → 通过内置服务器预览        │       │   │ │
│  │  │         │                                           │       │   │ │
│  │  │         └───────────────────────────────────────────┘       │   │ │
│  │  │                                                             │   │ │
│  │  └─────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  │  操作按钮:  [🌐 打开预览]  [📦 下载安装包]  [🐳 下载Docker镜像]      │ │
│  │             [📱 二维码分享]  [🔗 复制预览链接]                       │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 📋 交付物清单                                                        │ │
│  │                                                                      │ │
│  │  ✅ 可运行程序     app.exe        45.2 MB   刚刚生成   🟢 正常       │ │
│  │  ✅ 源代码         src/           2.1 MB    刚刚生成   🟢 已提交     │ │
│  │  ✅ 测试报告       test-report/   156 KB    覆盖率78%  📊 查看       │ │
│  │  ✅ 文档          docs/          89 KB     README + API  📖 阅读    │ │
│  │  ⏳ 构建产物       dist/          -         构建中...    ⏳ 80%      │ │
│  │                                                                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 📊 质量报告                                                          │ │
│  │                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────┐   │ │
│  │  │ 指标分类     │ 指标名称      │ 当前值    │ 目标值    │ 状态   │   │ │
│  │  │ ───────────────────────────────────────────────────────────│   │ │
│  │  │ 🧪 测试      │ 测试覆盖率    │ 78%      │ 80%      │ ⚠️ 接近│   │ │
│  │  │              │ 单元测试数    │ 156      │ -        │ ✅     │   │ │
│  │  │              │ 集成测试数    │ 23       │ -        │ ✅     │   │ │
│  │  │ ───────────────────────────────────────────────────────────│   │ │
│  │  │ 🏗️ 构建      │ 构建状态      │ ✅ 通过   │ -        │ ✅     │   │ │
│  │  │              │ 构建时间      │ 2分30秒   │ <5分钟   │ ✅     │   │ │
│  │  │              │ 包大小        │ 45.2 MB   │ <100MB   │ ✅     │   │ │
│  │  │ ───────────────────────────────────────────────────────────│   │ │
│  │  │ 🔒 安全      │ 安全扫描      │ ✅ 通过   │ -        │ ✅     │   │ │
│  │  │              │ 漏洞数量      │ 0         │ 0        │ ✅     │   │ │
│  │  │              │ 依赖审计      │ ✅ 通过   │ -        │ ✅     │   │ │
│  │  │ ───────────────────────────────────────────────────────────│   │ │
│  │  │ ⚡ 性能      │ 首屏加载      │ 1.2秒     │ <2秒     │ ✅     │   │ │
│  │  │              │ Lighthouse    │ 85/100    │ >80      │ ✅     │   │ │
│  │  └─────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 📝 更新日志                                                          │ │
│  │                                                                      │ │
│  │  v1.0.0 (2024-01-15)                                                │ │
│  │  ─────────────────────────────────────────────────────────────────  │ │
│  │  ✨ 新功能                                                           │ │
│  │     • 实现用户认证模块（注册、登录、Token刷新）                       │ │
│  │     • 添加密码重置功能（邮件发送）                                   │ │
│  │     • 实现权限中间件                                                 │ │
│  │                                                                      │ │
│  │  🐛 修复                                                             │ │
│  │     • 修复登录页面样式问题                                           │ │
│  │     • 修复Token过期处理逻辑                                         │ │
│  │                                                                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 四、项目结构设计

### 4.1 整体目录结构

```
devpilot/
├── 📦 packages/                          # PNPM Workspace
│   ├── 📁 core/                          # 核心引擎 (Node.js)
│   ├── 📁 ui/                            # Electron桌面UI (Vue 3)
│   ├── 📁 adapters/                      # 语言/框架适配器
│   └── 📁 shared/                        # 共享类型和工具
│
├── 📄 package.json                       # Workspace配置
├── 📄 pnpm-workspace.yaml
├── 📄 README.md
├── 📄 LICENSE (Apache 2.0)
├── 📄 .gitignore
├── 📄 .eslintrc.js
├── 📄 .prettierrc
├── 📄 tsconfig.base.json
└── 📄 .github/
    └── workflows/
        └── ci.yml                        # CI配置
```

### 4.2 Core 模块结构

```
packages/core/
├── src/
│   ├── 📁 llm/                           # LLM引擎
│   │   ├── index.ts                      # 统一出口
│   │   ├── base.ts                       # 抽象基类
│   │   ├── openai.ts                     # OpenAI适配器
│   │   ├── anthropic.ts                  # Claude适配器
│   │   ├── ollama.ts                     # 本地Ollama适配器
│   │   ├── custom.ts                     # 自定义API适配器
│   │   └── registry.ts                   # 适配器注册表
│   │
│   ├── 📁 executor/                      # 代码执行器
│   │   ├── index.ts
│   │   ├── sandbox/                      # 沙箱隔离
│   │   │   ├── docker.ts                 # Docker沙箱
│   │   │   └── native.ts                 # 原生执行(信任代码)
│   │   ├── language/                     # 语言执行器
│   │   │   ├── python.ts
│   │   │   ├── java.ts
│   │   │   ├── node.ts
│   │   │   ├── vue.ts
│   │   │   └── types.ts
│   │   └── tools/                        # 开发工具
│   │       ├── eslint.ts
│   │       ├── typescript.ts
│   │       └── maven.ts
│   │
│   ├── 📁 builder/                       # 构建系统
│   │   ├── index.ts
│   │   ├── vite.ts                       # Vue/前端构建
│   │   ├── vite-plugin-inject-preload.ts
│   │   ├── gradle.ts                     # Java构建
│   │   ├── poetry.ts                     # Python构建
│   │   ├── docker.ts                     # Docker镜像构建
│   │   └── electron-builder.ts           # Electron打包
│   │
│   ├── 📁 scheduler/                     # 任务调度
│   │   ├── index.ts
│   │   ├── queue.ts                      # 任务队列(BullMQ)
│   │   ├── worker.ts                     # 工作进程
│   │   ├── task/                         # 任务定义
│   │   │   ├── types.ts
│   │   │   ├── task.ts                   # 基础任务类
│   │   │   ├── requirement.ts            # 需求解析任务
│   │   │   ├── codegen.ts                # 代码生成任务
│   │   │   ├── testgen.ts                # 测试生成任务
│   │   │   ├── build.ts                  # 构建任务
│   │   │   ├── deploy.ts                 # 部署任务
│   │   │   └── review.ts                 # 代码审查任务
│   │   └── analyzer/                     # 任务分析
│   │       ├── dependency.ts             # 依赖分析
│   │       ├── impact.ts                 # 影响范围分析
│   │       └── complexity.ts             # 复杂度分析
│   │
│   ├── 📁 plugins/                       # 插件系统
│   │   ├── index.ts
│   │   ├── manager.ts                    # 插件管理器
│   │   ├── hooks.ts                      # 生命周期钩子
│   │   ├── api.ts                        # 插件API
│   │   └── types.ts                      # 插件类型
│   │
│   ├── 📁 storage/                       # 数据存储
│   │   ├── index.ts
│   │   ├── database.ts                   # SQLite封装
│   │   ├── repositories/                 # 数据仓库
│   │   │   ├── project.repository.ts
│   │   │   ├── task.repository.ts
│   │   │   └── llm-config.repository.ts
│   │   └── migrations/                   # 迁移脚本
│   │       └── 001_initial.sql
│   │
│   └── 📁 utils/                         # 工具函数
│       ├── path.ts
│       ├── file.ts
│       ├── process.ts
│       └── logger.ts
│
├── package.json
├── tsconfig.json
└── README.md
```

### 4.3 UI 模块结构

```
packages/ui/
├── src/
│   ├── 📁 main/                          # Electron主进程
│   │   ├── main.ts                       # 应用入口
│   │   ├── menu.ts                       # 菜单模板
│   │   ├── tray.ts                       # 系统托盘
│   │   ├── app.ts                        # 应用生命周期
│   │   ├── ipc/                          # IPC处理器
│   │   │   ├── index.ts
│   │   │   ├── project.ts                # 项目管理IPC
│   │   │   ├── task.ts                   # 任务管理IPC
│   │   │   ├── llm.ts                    # LLM配置IPC
│   │   │   ├── build.ts                  # 构建IPC
│   │   │   └── preview.ts                # 预览IPC
│   │   └── handlers/                     # 事件处理
│   │       ├── window.handler.ts
│   │       └── app.handler.ts
│   │
│   ├── 📁 preload/                       # 预加载脚本
│   │   └── index.ts                      # 暴露安全API
│   │
│   ├── 📁 views/                         # 渲染进程视图
│   │   ├── app.vue                       # 根组件
│   │   ├── router.ts                     # Vue Router
│   │   ├── styles/                       # 全局样式
│   │   │   ├── main.css
│   │   │   ├── variables.css
│   │   │   └── reset.css
│   │   │
│   │   ├── 📁 stores/                    # Pinia状态
│   │   │   ├── index.ts
│   │   │   ├── project.ts                # 项目状态
│   │   │   ├── task.ts                   # 任务状态
│   │   │   ├── settings.ts               # 设置状态
│   │   │   ├── llm.ts                    # LLM配置状态
│   │   │   └── ui.ts                     # UI状态
│   │   │
│   │   ├── 📁 pages/                     # 页面组件
│   │   │   ├── index.vue                 # 主入口
│   │   │   │
│   │   │   ├── 📁 dashboard/             # 看板页面
│   │   │   │   ├── index.vue
│   │   │   │   ├── components/
│   │   │   │   │   ├── TaskBoard.vue     # 看板组件
│   │   │   │   │   ├── TaskCard.vue      # 任务卡片
│   │   │   │   │   ├── TaskColumn.vue    # 任务列
│   │   │   │   │   ├── TaskModal.vue     # 任务详情/微调
│   │   │   │   │   ├── ProjectOverview.vue # 项目概览
│   │   │   │   │   ├── CreateTaskForm.vue # 创建任务表单
│   │   │   │   │   └── ImportModal.vue    # 导入需求弹窗
│   │   │   │   ├── composables/
│   │   │   │   │   ├── useTaskBoard.ts
│   │   │   │   │   └── useTaskDrag.ts
│   │   │   │   └── types.ts
│   │   │   │
│   │   │   ├── 📁 progress/              # 进度页面
│   │   │   │   ├── index.vue
│   │   │   │   ├── components/
│   │   │   │   │   ├── MilestoneProgress.vue     # 里程碑进度
│   │   │   │   │   ├── RealTimeStatus.vue        # 实时状态
│   │   │   │   │   ├── ExecutionLog.vue          # 执行日志
│   │   │   │   │   ├── RiskAlert.vue             # 风险预警
│   │   │   │   │   ├── TaskDetailPanel.vue       # 任务详情面板
│   │   │   │   │   └── TimelineView.vue          # 时间线视图
│   │   │   │   ├── composables/
│   │   │   │   │   ├── useProgress.ts
│   │   │   │   │   └── useLogStream.ts
│   │   │   │   └── types.ts
│   │   │   │
│   │   │   └── 📁 preview/               # 产品体验页面
│   │   │       ├── index.vue
│   │   │       ├── components/
│   │   │       │   ├── ProductDisplay.vue        # 产品展示
│   │   │       │   ├── DeliveryList.vue          # 交付物清单
│   │   │       │   ├── QualityReport.vue         # 质量报告
│   │   │       │   ├── PreviewFrame.vue          # 预览框架
│   │   │       │   ├── DownloadPanel.vue         # 下载面板
│   │   │       │   └── ChangelogViewer.vue       # 更新日志
│   │   │       ├── composables/
│   │   │       │   ├── useProductPreview.ts
│   │   │       │   └── useDelivery.ts
│   │   │       └── types.ts
│   │   │
│   │   └── 📁 components/                # 通用组件
│   │       ├── Layout.vue                # 主布局
│   │       ├── Navigation.vue            # 导航栏
│   │       ├── Sidebar.vue               # 侧边栏
│   │       ├── Toast.vue                 # 通知提示
│   │       ├── Modal.vue                 # 弹窗
│   │       ├── Loading.vue               # 加载动画
│   │       ├── EmptyState.vue            # 空状态
│   │       ├── ConfirmDialog.vue         # 确认对话框
│   │       ├── FileSelector.vue          # 文件选择器
│   │       └── Icons/                    # 图标组件
│   │
│   └── 📁 assets/                        # 静态资源
│       ├── icons/                        # SVG图标
│       └── images/                       # 图片资源
│
├── package.json
├── tsconfig.json
├── vite.config.ts
├── electron.vite.config.ts               # Electron Vite配置
└── electron-builder.json5                # Electron打包配置
```

### 4.4 Adapters 模块结构

```
packages/adapters/
├── src/
│   ├── 📁 languages/                     # 语言适配器
│   │   ├── index.ts                      # 统一出口
│   │   ├── registry.ts                   # 适配器注册表
│   │   ├── base.ts                       # 基础适配器接口
│   │   │
│   │   ├── 📁 python/                    # Python适配器
│   │   │   ├── index.ts
│   │   │   ├── config.ts                 # 项目配置
│   │   │   ├── executor.ts               # 执行器
│   │   │   ├── builder.ts                # 构建器 (Poetry/Pip)
│   │   │   ├── testrunner.ts             # 测试运行器 (pytest)
│   │   │   ├── linter.ts                 # 代码检查 (pylint/ruff)
│   │   │   ├── typechecker.ts            # 类型检查 (mypy)
│   │   │   ├── templates/                # 项目模板
│   │   │   │   ├── fastapi/
│   │   │   │   ├── django/
│   │   │   │   ├── flask/
│   │   │   │   └── python-package/
│   │   │   └── utils/
│   │   │
│   │   ├── 📁 java/                      # Java适配器
│   │   │   ├── index.ts
│   │   │   ├── config.ts
│   │   │   ├── executor.ts
│   │   │   ├── builder.ts                # 构建器 (Maven/Gradle)
│   │   │   ├── testrunner.ts             # 测试运行器 (JUnit)
│   │   │   ├── linter.ts                 # 代码检查 (Checkstyle)
│   │   │   ├── typechecker.ts            # 类型检查
│   │   │   ├── templates/
│   │   │   │   ├── spring-boot/
│   │   │   │   ├── maven-quickstart/
│   │   │   │   └── java-commons/
│   │   │   └── utils/
│   │   │
│   │   ├── 📁 vue/                       # Vue适配器
│   │   │   ├── index.ts
│   │   │   ├── config.ts
│   │   │   ├── executor.ts
│   │   │   ├── builder.ts                # 构建器 (Vite)
│   │   │   ├── testrunner.ts             # 测试运行器 (Vitest)
│   │   │   ├── linter.ts                 # 代码检查 (ESLint)
│   │   │   ├── typechecker.ts            # 类型检查 (vue-tsc)
│   │   │   ├── templates/
│   │   │   │   ├── vite-vue-ts/
│   │   │   │   ├── vite-vue/
│   │   │   │   └── vite-vue-electron/
│   │   │   └── utils/
│   │   │
│   │   ├── 📁 javascript/                # JavaScript适配器
│   │   │   ├── index.ts
│   │   │   ├── config.ts
│   │   │   ├── executor.ts
│   │   │   ├── builder.ts                # 构建器 (Vite/Webpack)
│   │   │   ├── testrunner.ts             # 测试运行器 (Jest/Vitest)
│   │   │   ├── linter.ts
│   │   │   └── templates/
│   │   │       ├── vite-js/
│   │   │       ├── webpack-basic/
│   │   │       └── node-express/
│   │   │
│   │   ├── 📁 typescript/                # TypeScript适配器
│   │   │   ├── index.ts
│   │   │   ├── config.ts
│   │   │   ├── executor.ts
│   │   │   ├── builder.ts
│   │   │   ├── testrunner.ts
│   │   │   ├── linter.ts
│   │   │   ├── typechecker.ts            # 专用tsc配置
│   │   │   └── templates/
│   │   │       ├── vite-ts/
│   │   │       └── node-ts/
│   │   │
│   │   ├── 📁 rust/                      # Rust适配器 (后续)
│   │   ├── 📁 go/                        # Go适配器 (后续)
│   │   └── 📁 dotnet/                    # .NET适配器 (后续)
│   │
│   ├── 📁 tools/                         # 工具适配器
│   │   ├── docker/                       # Docker适配器
│   │   │   ├── index.ts
│   │   │   ├── builder.ts                # Docker镜像构建
│   │   │   ├── runner.ts                 # 容器运行
│   │   │   └── utils/
│   │   │
│   │   ├── 📁 git/                       # Git适配器
│   │   │   ├── index.ts
│   │   │   ├── commands.ts               # Git命令封装
│   │   │   └── utils/
│   │   │
│   │   ├── 📁 database/                  # 数据库适配器
│   │   │   ├── index.ts
│   │   │   ├── postgresql.ts
│   │   │   ├── mysql.ts
│   │   │   └── sqlite.ts
│   │   │
│   │   └── 📁 package-manager/           # 包管理器适配器
│   │       ├── npm.ts
│   │       ├── pnpm.ts
│   │       ├── yarn.ts
│   │       ├── pip.ts
│   │       ├── poetry.ts
│   │       ├── maven.ts
│   │       └── gradle.ts
│   │
│   └── 📁 registry.ts                    # 全局适配器注册表
│
├── package.json
└── tsconfig.json
```

### 4.5 Shared 模块结构

```
packages/shared/
├── src/
│   ├── 📁 types/                         # 类型定义
│   │   ├── index.ts
│   │   ├── project.types.ts              # 项目类型
│   │   ├── task.types.ts                 # 任务类型
│   │   ├── llm.types.ts                  # LLM类型
│   │   ├── adapter.types.ts              # 适配器类型
│   │   ├── build.types.ts                # 构建类型
│   │   └── common.types.ts               # 通用类型
│   │
│   ├── 📁 utils/                         # 共享工具
│   │   ├── index.ts
│   │   ├── path.ts
│   │   ├── object.ts
│   │   ├── validation.ts
│   │   └── logger.ts
│   │
│   ├── 📁 constants/                     # 常量
│   │   ├── index.ts
│   │   ├── task-priority.ts
│   │   ├── task-status.ts
│   │   └── project-status.ts
│   │
│   └── 📁 schemas/                       # JSON Schema
│       ├── index.ts
│       ├── project-config.schema.json
│       ├── adapter-config.schema.json
│       └── llm-config.schema.json
│
├── package.json
└── tsconfig.json
```

---

## 五、数据模型设计

### 5.1 核心实体关系

```
┌─────────────────────────────────────────────────────────────────┐
│                        实体关系图                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────┐         ┌─────────────┐                        │
│  │  Project    │ 1    N  │    Task     │                        │
│  │  ─────────  │─────────│  ─────────  │                        │
│  │  id         │         │  id         │                        │
│  │  name       │         │  project_id │                        │
│  │  path       │         │  type       │                        │
│  │  language   │         │  status     │                        │
│  │  config     │         │  priority   │                        │
│  │  status     │         │  input      │                        │
│  │  created_at │         │  output     │                        │
│  │  updated_at │         │  progress   │                        │
│  └─────────────┘         │  logs       │                        │
│                          │  created_at │                        │
│                          │  started_at │                        │
│                          │  completed_at│                        │
│                          └─────────────┘                        │
│                                  │                               │
│                         N    1   │   N    1                      │
│                          └───────┴───────┘                       │
│                                  │                               │
│  ┌─────────────┐         ┌─────────────┐                        │
│  │  Milestone  │ 1    N  │ TaskGroup   │                        │
│  │  ─────────  │─────────│  ─────────  │                        │
│  │  id         │         │  id         │                        │
│  │  project_id │         │  name       │                        │
│  │  name       │         │  task_ids   │                        │
│  │  progress   │         │  created_at │                        │
│  │  status     │         └─────────────┘                        │
│  │  due_date   │                                                 │
│  └─────────────┘                                                 │
│                                                                  │
│  ┌─────────────┐         ┌─────────────┐                        │
│  │  LLMConfig  │         │  Execution  │                        │
│  │  ─────────  │         │  ─────────  │                        │
│  │  id         │         │  id         │                        │
│  │  name       │         │  task_id    │                        │
│  │  provider   │         │  status     │                        │
│  │  base_url   │         │  start_time │                        │
│  │  api_key    │         │  end_time   │                        │
│  │  model      │         │  logs       │                        │
│  │  options    │         │  result     │                        │
│  │  enabled    │         │  error      │                        │
│  │  is_default │         └─────────────┘                        │
│  └─────────────┘                                                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 详细类型定义

```typescript
// ============ 项目类型 ============

interface Project {
  id: string;
  name: string;
  path: string;                          // 本地绝对路径
  description?: string;
  language: string;                      // 主语言: 'python' | 'java' | 'vue' | 'javascript' | 'typescript' | 'rust' | 'go'
  framework?: string;                    // 框架: 'fastapi' | 'spring-boot' | 'vite' | etc.
  adapter: string;                       // 使用的适配器ID
  config: ProjectConfig;
  status: ProjectStatus;
  currentMilestoneId?: string;
  createdAt: Date;
  updatedAt: Date;
}

type ProjectStatus = 'active' | 'paused' | 'completed' | 'archived';

interface ProjectConfig {
  // 构建配置
  buildTool: string;                     // 'vite' | 'gradle' | 'poetry' | etc.
  packageManager: string;                // 'pnpm' | 'npm' | 'yarn' | 'poetry' | 'maven'
  
  // 测试配置
  testFramework: string;                 // 'vitest' | 'pytest' | 'junit' | etc.
  coverageThreshold: number;             // 覆盖率阈值 0-100
  
  // 代码规范
  linter: string;                        // 'eslint' | 'pylint' | 'checkstyle'
  formatter: string;                     // 'prettier' | 'black' | etc.
  
  // 部署配置
  deployTarget: DeployTarget;            // 部署目标
  environment: 'development' | 'staging' | 'production';
  
  // 自定义配置
  customCommands: Record<string, string>;
  customEnv: Record<string, string>;
}

type DeployTarget = 'local' | 'docker' | 'cloud' | 'github-pages';

// ============ 任务类型 ============

interface Task {
  id: string;
  projectId: string;
  groupId?: string;                      // 任务组ID（关联任务）
  type: TaskType;
  status: TaskStatus;
  priority: TaskPriority;
  
  // 任务内容
  name: string;
  description: string;                   // 自然语言描述
  input: TaskInput;
  output?: TaskOutput;
  
  // 执行信息
  progress: number;                      // 0-100
  logs: TaskLog[];
  error?: string;
  metadata: TaskMetadata;
  
  // 时间信息
  createdAt: Date;
  startedAt?: Date;
  completedAt?: Date;
  estimatedDuration?: number;            // 预估时间(秒)
}

type TaskType = 
  | 'requirement'        // 需求分析
  | 'architecture'       // 架构设计
  | 'codegen'            // 代码生成
  | 'testgen'            // 测试生成
  | 'codereview'         // 代码审查
  | 'refactor'           // 重构
  | 'build'              // 构建
  | 'test'               // 测试执行
  | 'deploy'             // 部署
  | 'document'           // 文档生成
  | 'review';            // 人工审核

type TaskStatus = 
  | 'pending'            // 等待中
  | 'queued'             // 已入队
  | 'running'            // 执行中
  | 'completed'          // 完成
  | 'failed'             // 失败
  | 'cancelled'          // 取消
  | 'paused'             // 暂停
  | 'waiting_review'     // 等待审核;

type TaskPriority = 'critical' | 'high' | 'medium' | 'low';

interface TaskInput {
  // 代码生成输入
  requirements?: string;                 // 自然语言需求
  technicalSpecs?: TechnicalSpec[];
  codeContext?: CodeContext;
  
  // 测试生成输入
  targetFiles?: string[];
  testType?: 'unit' | 'integration' | 'e2e';
  
  // 构建输入
  buildTarget?: string;
  buildOptions?: Record<string, any>;
}

interface TaskOutput {
  // 代码生成输出
  generatedFiles?: GeneratedFile[];
  
  // 测试输出
  testResults?: TestResult;
  
  // 构建输出
  buildArtifacts?: BuildArtifact[];
  
  // 部署输出
  deployResult?: DeployResult;
}

interface TaskLog {
  timestamp: Date;
  level: 'debug' | 'info' | 'warn' | 'error';
  message: string;
  details?: Record<string, any>;
}

interface TaskMetadata {
  // 任务依赖
  dependencies?: string[];               // 依赖的任务ID
  
  // AI生成信息
  llmProvider?: string;
  llmModel?: string;
  promptTokens?: number;
  completionTokens?: number;
  
  // 执行统计
  retryCount?: number;
  lastRetryAt?: Date;
  
  // 版本控制
  gitCommit?: string;
  branch?: string;
}

interface GeneratedFile {
  path: string;
  content: string;
  language: string;
  type: 'source' | 'test' | 'config' | 'document' | 'other';
  size: number;
}

interface CodeContext {
  existingFiles: string[];
  projectStructure: ProjectStructure;
  dependencies: Dependency[];
}

interface ProjectStructure {
  root: string;
  directories: DirectoryNode[];
  files: FileNode[];
}

interface DirectoryNode {
  name: string;
  path: string;
  children: (DirectoryNode | FileNode)[];
}

interface FileNode {
  name: string;
  path: string;
  language: string;
  size: number;
  modifiedAt: Date;
}

interface Dependency {
  name: string;
  version: string;
  type: 'production' | 'development';
  source: 'package.json' | 'requirements.txt' | 'pom.xml' | 'Cargo.toml';
}

// ============ 里程碑类型 ============

interface Milestone {
  id: string;
  projectId: string;
  name: string;
  description: string;
  taskIds: string[];                     // 包含的任务ID
  progress: number;
  status: MilestoneStatus;
  dueDate?: Date;
  completedAt?: Date;
  createdAt: Date;
}

type MilestoneStatus = 'pending' | 'in_progress' | 'completed' | 'failed';

// ============ LLM配置类型 ============

interface LLMConfig {
  id: string;
  name: string;
  provider: LLMProvider;
  baseUrl: string;
  apiKey?: string;
  model: string;
  options: LLMOptions;
  enabled: boolean;
  isDefault: boolean;
  createdAt: Date;
  updatedAt: Date;
}

type LLMProvider = 'openai' | 'anthropic' | 'ollama' | 'custom';

interface LLMOptions {
  temperature?: number;                  // 0-2, 默认0.7
  maxTokens?: number;                    // 最大token数
  timeout?: number;                      // 超时时间(毫秒)
  topP?: number;
  frequencyPenalty?: number;
  presencePenalty?: number;
  retryAttempts?: number;                // 重试次数
  retryDelay?: number;                   // 重试延迟(毫秒)
}

interface LLMMessage {
  role: 'system' | 'user' | 'assistant';
  content: string;
}

interface LLMRequest {
  messages: LLMMessage[];
  options?: Partial<LLMOptions>;
  stream?: boolean;
}

interface LLMResponse {
  content: string;
  usage: {
    promptTokens: number;
    completionTokens: number;
    totalTokens: number;
  };
  model: string;
}

// ============ 适配器配置类型 ============

interface AdapterConfig {
  id: string;
  language: string;
  framework?: string;
  version?: string;
  
  // 构建配置
  buildTool: string;
  buildCommand: string;
  buildArgs?: string[];
  
  // 测试配置
  testFramework: string;
  testCommand: string;
  testArgs?: string[];
  coverageCommand?: string;
  
  // 代码检查
  linter?: string;
  linterCommand?: string;
  linterArgs?: string[];
  
  // 包管理
  packageManager: string;
  installCommand: string;
  
  // 文件模板
  templates: AdapterTemplate[];
  
  // 自定义脚本
  customScripts?: Record<string, string>;
}

interface AdapterTemplate {
  id: string;
  name: string;
  description: string;
  files: TemplateFile[];
  dependencies?: Record<string, string>;
  devDependencies?: Record<string, string>;
}

interface TemplateFile {
  path: string;
  content: string;
  executable?: boolean;
}

// ============ 执行结果类型 ============

interface TestResult {
  total: number;
  passed: number;
  failed: number;
  skipped: number;
  coverage?: CoverageResult;
  duration: number;
  output: string;
}

interface CoverageResult {
  lineCoverage: number;
  branchCoverage: number;
  functionCoverage: number;
  statementCoverage: number;
  files: CoverageFile[];
}

interface CoverageFile {
  path: string;
  coverage: number;
  coveredLines: number;
  totalLines: number;
}

interface BuildArtifact {
  path: string;
  size: number;
  type: 'bundle' | 'package' | 'docker-image' | 'executable';
  platform?: string;
}

interface DeployResult {
  url?: string;
  environment: string;
  deployedAt: Date;
  artifacts: BuildArtifact[];
}
```

---

## 六、AI任务流程设计

### 6.1 整体流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         AI任务执行全流程                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  用户输入需求                                                            │
│      │                                                                   │
│      ▼                                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                    Step 1: 需求解析 (Requirement Analysis)         │ │
│  │                                                                    │ │
│  │    输入: 自然语言需求                                               │ │
│  │    过程:                                                          │ │
│  │         1. LLM解析需求意图                                          │ │
│  │         2. 提取功能点列表                                           │ │
│  │         3. 识别技术约束                                             │ │
│  │         4. 估算工作量                                               │ │
│  │    输出: 需求规格说明书                                              │ │
│  │                                                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│      │                                                                   │
│      ▼                                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                    Step 2: 任务分解 (Task Decomposition)           │ │
│  │                                                                    │ │
│  │    输入: 需求规格说明书                                              │ │
│  │    过程:                                                          │ │
│  │         1. 识别模块边界                                             │ │
│  │         2. 分解原子任务                                             │ │
│  │         3. 确定任务依赖                                             │ │
│  │         4. 排序执行顺序                                             │ │
│  │    输出: 任务列表 + 依赖图                                          │ │
│  │                                                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│      │                                                                   │
│      ▼                                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                    Step 3: 架构设计 (Architecture Design)          │ │
│  │                                                                    │ │
│  │    输入: 需求规格说明书 + 任务列表                                   │ │
│  │    过程:                                                          │ │
│  │         1. 选择技术栈                                               │ │
│  │         2. 设计项目结构                                             │ │
│  │         3. 定义模块接口                                             │ │
│  │         4. 设计数据模型                                             │ │
│  │    输出: 架构设计文档 + 项目模板                                     │ │
│  │                                                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│      │                                                                   │
│      ├───────────────────────────────────────────────────────────────  │
│      │                                                               │ │
│      ▼                                                               ▼
│  ┌─────────────────────────────┐           ┌─────────────────────────┐ │
│  │   Step 4a: 代码生成         │           │   Step 4b: 测试生成      │ │
│  │                             │           │                         │ │
│  │   输入: 任务需求 + 架构      │           │   输入: 生成的代码       │ │
│  │                             │           │                         │ │
│  │   过程:                     │           │   过程:                 │ │
│  │   1. 读取项目上下文          │           │   1. 分析代码结构       │ │
│  │   2. 生成代码骨架            │           │   2. 识别测试点        │ │
│  │   3. 填充业务逻辑            │    ←→     │   3. 生成单元测试      │ │
│  │   4. 代码审查优化            │           │   4. 生成集成测试      │ │
│  │   5. 生成API文档             │           │                         │ │
│  │                             │           │                         │ │
│  │   输出: 源代码文件           │           │   输出: 测试用例文件    │ │
│  └─────────────────────────────┘           └─────────────────────────┘ │
│      │                                           │                     │
│      └───────────────────────────────────────────┼─────────────────────┘
│                                                  │
│                                                  ▼
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                    Step 5: 代码审查 (Code Review)                  │ │
│  │                                                                    │ │
│  │    输入: 源代码 + 测试代码                                          │ │
│  │    过程:                                                          │ │
│  │         1. 静态分析 (ESLint/Checkstyle)                            │ │
│  │         2. 安全扫描 (漏洞检测)                                      │ │
│  │         3. 最佳实践检查                                            │ │
│  │         4. AI代码审查建议                                          │ │
│  │    输出: 审查报告 + 修复建议                                        │ │
│  │                                                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│      │                                                                   │
│      ├───────────────────────────────────────────────────────────────  │
│      │                                                               │ │
│      ▼                                                               ▼
│  ┌─────────────────────────────┐           ┌─────────────────────────┐ │
│  │   Step 6a: 构建打包         │           │   Step 6b: 运行测试      │ │
│  │                             │           │                         │ │
│  │   输入: 完整源代码           │           │   输入: 测试代码         │ │
│  │                             │           │                         │ │
│  │   过程:                     │           │   过程:                 │ │
│  │   1. 安装依赖               │           │   1. 安装测试依赖       │ │
│  │   2. 执行构建命令            │           │   2. 运行测试套件       │ │
│  │   3. 生成产物               │    ←→     │   3. 收集测试结果       │ │
│  │   4. 产物签名(如需要)        │           │   4. 生成覆盖率报告     │ │
│  │                             │           │                         │ │
│  │   输出: 构建产物             │           │   输出: 测试报告        │ │
│  └─────────────────────────────┘           └─────────────────────────┘ │
│      │                                           │                     │
│      └───────────────────────────────────────────┼─────────────────────┘
│                                                  │
│                                                  ▼
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                    Step 7: 部署交付 (Deployment)                   │ │
│  │                                                                    │ │
│  │    输入: 构建产物 + 测试报告                                        │ │
│  │    过程:                                                          │ │
│  │         1. 验证测试通过                                             │ │
│  │         2. 生成部署包                                               │ │
│  │         3. 启动预览服务                                             │ │
│  │         4. 生成交付文档                                             │ │
│  │    输出: 可部署产物 + 预览链接                                      │ │
│  │                                                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│      │                                                                   │
│      ▼                                                                   │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                    Step 8: 结果汇报 (Reporting)                    │ │
│  │                                                                    │ │
│  │    输出:                                                          │ │
│  │         1. 更新看板状态                                             │ │
│  │         2. 生成质量报告                                             │ │
│  │         3. 更新里程碑进度                                           │ │
│  │         4. 通知用户                                                 │ │
│  │                                                                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.2 任务依赖调度

```typescript
// 任务调度逻辑示例
class TaskScheduler {
  private queue: BullMQ.Queue;
  private dependencyGraph: DependencyGraph;
  
  async scheduleTasks(t projectasks: Task[],Id: string): Promise<void> {
    // 1. 构建依赖图
    const graph = this.dependencyGraph.build(tasks);
    
    // 2. 拓扑排序确定执行顺序
    const executionOrder = graph.topologicalSort();
    
    // 3. 入队执行（按依赖顺序）
    for (const task of executionOrder) {
      const dependencies = graph.getDependencies(task.id);
      
      await this.queue.add(
        `task-${task.id}`,
        {
          projectId,
          taskId: task.id,
          dependencies: dependencies.map(d => d.id),
        },
        {
          priority: this.getPriorityValue(task.priority),
          delay: 0,
          attempts: task.metadata.retryAttempts ?? 3,
          backoff: { type: 'exponential', delay: 1000 },
          removeOnComplete: 100,
          removeOnFail: 50,
        }
      );
    }
  }
  
  private getPriorityValue(priority: TaskPriority): number {
    switch (priority) {
      case 'critical': return 1;
      case 'high': return 2;
      case 'medium': return 3;
      case 'low': return 4;
      default: return 3;
    }
  }
}
```

---

## 七、LLM配置设计

### 7.1 配置模型

```typescript
interface LLMProviderConfig {
  // 基础配置
  id: string;
  name: string;
  provider: 'openai' | 'anthropic' | 'ollama' | 'custom';
  baseUrl: string;
  apiKey?: string;
  
  // 模型配置
  model: string;
  options: {
    temperature?: number;
    maxTokens?: number;
    topP?: number;
    frequencyPenalty?: number;
    presencePenalty?: number;
    timeout?: number;
  };
  
  // 使用配置
  enabled: boolean;
  isDefault: boolean;
  capabilities: LLMCapability[];
}

type LLMCapability = 
  | 'code-generation'
  | 'test-generation'
  | 'code-review'
  | 'requirement-analysis'
  | 'architecture-design'
  | 'refactoring'
  | 'documentation';
```

### 7.2 适配器接口

```typescript
// LLM适配器接口
interface LLMAdapter {
  id: string;
  name: string;
  
  // 配置验证
  validateConfig(config: LLMProviderConfig): boolean;
  
  // 聊天完成
  complete(messages: LLMMessage[], options?: Partial<LLMOptions>): Promise<LLMResponse>;
  
  // 流式完成
  completeStream(messages: LLMMessage[], options?: Partial<LLMOptions>): AsyncIterable<string>;
  
  // 获取模型列表
  listModels(): Promise<string[]>;
  
  // 健康检查
  healthCheck(): Promise<boolean>;
}

// OpenAI适配器实现
class OpenAIAdapter implements LLMAdapter {
  constructor(private client: OpenAI) {}
  
  async complete(messages: LLMMessage[], options?: Partial<LLMOptions>): Promise<LLMResponse> {
    const response = await this.client.chat.completions.create({
      model: this.config.model,
      messages: messages as any,
      temperature: options?.temperature ?? this.config.options.temperature,
      max_tokens: options?.maxTokens ?? this.config.options.maxTokens,
      // ... 其他参数
    });
    
    return {
      content: response.choices[0].message.content,
      usage: {
        promptTokens: response.usage.prompt_tokens,
        completionTokens: response.usage.completion_tokens,
        totalTokens: response.usage.total_tokens,
      },
      model: response.model,
    };
  }
  
  async *completeStream(messages: LLMMessage[], options?: Partial<LLMOptions>): AsyncIterable<string> {
    const stream = await this.client.chat.completions.create({
      model: this.config.model,
      messages: messages as any,
      stream: true,
      // ... 其他参数
    });
    
    for await (const chunk of stream) {
      yield chunk.choices[0]?.delta?.content || '';
    }
  }
}

// Ollama本地适配器实现
class OllamaAdapter implements LLMAdapter {
  constructor(private baseUrl: string) {}
  
  async complete(messages: LLMMessage[], options?: Partial<LLMOptions>): Promise<LLMResponse> {
    const response = await fetch(`${this.baseUrl}/api/generate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: this.config.model,
        messages: messages.map(m => ({ role: m.role, content: m.content })),
        options: {
          temperature: options?.temperature ?? this.config.options.temperature,
          num_predict: options?.maxTokens ?? this.config.options.maxTokens,
        },
      }),
    });
    
    const data = await response.json();
    return {
      content: data.response,
      usage: {
        promptTokens: data.prompt_eval_count,
        completionTokens: data.eval_count,
        totalTokens: data.prompt_eval_count + data.eval_count,
      },
      model: this.config.model,
    };
  }
}
```

### 7.3 配置UI

```
┌─────────────────────────────────────────────────────────────────────────┐
│  LLM配置面板                                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ [+ 添加新的LLM配置]                                                  │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 🟢 OpenAI (默认)                                                     │ │
│  │ ─────────────────────────────────────────────────────────────────   │ │
│  │  提供商:  OpenAI                    [✓] 启用                        │ │
│  │  模型:    gpt-4-turbo              [🌐 查看模型列表]                │ │
│  │  API URL: https://api.openai.com/v1                               │ │
│  │  API Key: ****************************************                  │ │
│  │  温度:    0.7                        最高Token: 4096               │ │
│  │  超时:    60000ms                   重试次数: 3                    │ │
│  │                                                                      │ │
│  │  支持能力:  [✓] 代码生成  [✓] 测试生成  [✓] 代码审查  [✓] 需求分析  │ │
│  │                                                                      │ │
│  │  ────────────────────────────────────────────────────────────────   │ │
│  │  [⚙️ 编辑]  [📋 复制]  [🗑️ 删除]  [⭐ 设为默认]                     │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 🟢 Ollama (本地)                                                     │ │
│  │ ─────────────────────────────────────────────────────────────────   │ │
│  │  提供商:  Ollama (本地)              [✓] 启用                        │ │
│  │  模型:    llama3                     [🌐 查看模型列表]                │ │
│  │  API URL: http://localhost:11434/v1                               │ │
│  │  API Key: (无)                                                        │ │
│  │  温度:    0.7                        最高Token: 8192               │ │
│  │  超时:    120000ms                  重试次数: 3                    │ │
│  │                                                                      │ │
│  │  支持能力:  [✓] 代码生成  [✓] 测试生成  [✓] 代码审查  [ ] 需求分析  │ │
│  │                                                                      │ │
│  │  ────────────────────────────────────────────────────────────────   │ │
│  │  [⚙️ 编辑]  [📋 复制]  [🗑️ 删除]  [○ 设为默认]                     │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 🟡 Claude                                                            │ │
│  │ ─────────────────────────────────────────────────────────────────   │ │
│  │  提供商:  Anthropic Claude           [ ] 启用                        │ │
│  │  模型:    claude-3-5-sonnet-20241022                               │ │
│  │  API URL: https://api.anthropic.com/v1                             │ │
│  │  API Key: ****************************************                  │ │
│  │                                                                      │ │
│  │  ────────────────────────────────────────────────────────────────   │ │
│  │  [⚙️ 编辑]  [📋 复制]  [🗑️ 删除]  [○ 设为默认]                     │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 八、多项目支持设计

### 8.1 项目隔离策略

```typescript
interface ProjectIsolation {
  // 目录隔离
  directory: {
    root: string;                        // 项目根目录
    code: string;                        // 代码目录
    build: string;                       // 构建产物目录
    temp: string;                        // 临时文件目录
    logs: string;                        // 日志目录
  };
  
  // 进程隔离
  process: {
    env隔离: Record<string, string>;     // 独立环境变量
    cwd隔离: string;                     // 工作目录
    memoryLimit: number;                 // 内存限制 (MB)
    cpuLimit: number;                    // CPU限制 (%)
  };
  
  // 端口隔离
  network: {
    portRange: [number, number];         // 可用端口范围
    host: string;                        // 绑定主机
  };
  
  // 数据隔离
  data: {
    database隔离: string;                // 数据库文件路径
    cache隔离: string;                   // 缓存目录
  };
}

// 项目隔离配置示例
const projectIsolation: ProjectIsolation = {
  directory: {
    root: 'D:\\projects\\my-project',
    code: 'D:\\projects\\my-project\\src',
    build: 'D:\\projects\\my-project\\dist',
    temp: 'D:\\projects\\my-project\\.devpilot\\temp',
    logs: 'D:\\projects\\my-project\\.devpilot\\logs',
  },
  process: {
    env隔离: {
      NODE_ENV: 'development',
      PATH: '...',                       // 独立PATH
    },
    cwd隔离: 'D:\\projects\\my-project',
    memoryLimit: 512,                    // 512MB
    cpuLimit: 50,                        // 50%
  },
  network: {
    portRange: [3000, 3999],
    host: '127.0.0.1',
  },
  data: {
    database隔离: 'D:\\projects\\my-project\\.devpilot\\data.db',
    cache隔离: 'D:\\projects\\my-project\\.devpilot\\cache',
  },
};
```

### 8.2 并发任务调度

```typescript
class ProjectTaskScheduler {
  private maxConcurrentPerProject: number = 3;
  private maxConcurrentTotal: number = 10;
  
  async schedule(tasks: Task[]): Promise<void> {
    // 1. 按项目分组
    const projectTasks = this.groupByProject(tasks);
    
    // 2. 获取全局信号量
    const globalSemaphore = new Semaphore(this.maxConcurrentTotal);
    
    // 3. 为每个项目创建队列
    for (const [projectId, projectTaskList] of Object.entries(projectTasks)) {
      const projectSemaphore = new Semaphore(this.maxConcurrentPerProject);
      
      // 4. 并发执行项目内任务（受项目级限制）
      await Promise.all(
        projectTaskList.map(async (task) => {
          await globalSemaphore.acquire();
          await projectSemaphore.acquire();
          
          try {
            await this.executeTask(task);
          } finally {
            projectSemaphore.release();
            globalSemaphore.release();
          }
        })
      );
    }
  }
}
```

---

## 九、开发路线图

### Phase 1: 基础框架 (2周)

| 任务 | 描述 | 预估工时 |
|------|------|---------|
| 项目脚手架 | PNPM Workspace + TypeScript配置 | 4h |
| Electron主进程 | 窗口管理、菜单、托盘 | 8h |
| Vue3基础UI | 路由、状态管理、布局框架 | 8h |
| 数据库层 | SQLite集成、Repository模式 | 8h |
| 任务调度基础 | BullMQ队列、工作进程 | 8h |
| 基础通信 | IPC通信、Preload脚本 | 4h |

**交付物**: 可运行的桌面应用框架，具备基础窗口管理和数据存储

### Phase 2: LLM引擎 (1周)

| 任务 | 描述 | 预估工时 |
|------|------|---------|
| LLM抽象接口 | 统一适配器接口设计 | 4h |
| OpenAI适配器 | OpenAI API集成 | 8h |
| Claude适配器 | Anthropic API集成 | 8h |
| Ollama适配器 | 本地Ollama集成 | 8h |
| 自定义API适配器 | 支持任意兼容OpenAI API的服务 | 4h |
| 配置UI | LLM配置管理界面 | 8h |

**交付物**: 支持多LLM配置的AI引擎，支持OpenAI/Claude/Ollama

### Phase 3: 语言适配器 (2周)

| 任务 | 描述 | 预估工时 |
|------|------|---------|
| Python适配器 | FastAPI/Django/Flask模板 | 16h |
| Java适配器 | Spring Boot/Maven模板 | 16h |
| Vue适配器 | Vite + Vue3模板 | 12h |
| JS/TS适配器 | Node.js模板 | 8h |
| 适配器注册系统 | 热插拔机制 | 8h |

**交付物**: 支持Python/Java/Vue的多语言适配器系统

### Phase 4: 核心任务 (2周)

| 任务 | 描述 | 预估工时 |
|------|------|---------|
| 需求分析器 | 自然语言需求解析 | 16h |
| 代码生成器 | 基于需求的代码生成 | 24h |
| 测试生成器 | 单元测试自动生成 | 16h |
| 代码审查器 | 静态分析 + AI审查 | 12h |
| 构建系统 | 多框架构建集成 | 16h |

**交付物**: 完整的AI代码生成和测试流程

### Phase 5: UI完善 (1周)

| 任务 | 描述 | 预估工时 |
|------|------|---------|
| 看板界面 | 任务看板、拖拽、详情 | 16h |
| 进度界面 | 实时状态、日志、预警 | 16h |
| 产品体验界面 | 预览、下载、报告 | 16h |
| 设置页面 | LLM配置、项目管理 | 8h |

**交付物**: 完整的三大交互界面

### Phase 6: 多项目支持 (1周)

| 任务 | 描述 | 预估工时 |
|------|------|---------|
| 项目隔离 | 目录/进程/网络隔离 | 16h |
| 并发调度 | 多项目并发执行 | 12h |
| 项目切换 | 快速切换项目 | 8h |
| 项目导入 | 导入现有项目 | 8h |

**交付物**: 完整的多项目支持能力

### Phase 7: 集成测试与优化 (1周)

| 任务 | 描述 | 预估工时 |
|------|------|---------|
| 端到端测试 | 完整流程测试 | 16h |
| 性能优化 | 内存、响应优化 | 16h |
| 错误处理 | 异常恢复、日志完善 | 8h |
| 文档编写 | README、用户指南 | 8h |

**交付物**: 稳定可用的DevPilot 1.0版本

---

## 十、许可证

```
                                 Apache License
                           Version 2.0, January 2004
                        http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

      "License" shall mean the terms and conditions for use, reproduction,
      and distribution as defined by Sections 1 through 9 of this document.

      "Licensor" shall mean the copyright owner or entity authorized by
      the copyright owner that is granting the License.

      "Legal Entity" shall mean the union of the acting entity and all
      other entities that control, are controlled by, or are under common
      control with that entity. For the purposes of this definition,
      "control" means (i) the power, direct or indirect, to cause the
      direction or management of such entity, whether by contract or
      otherwise, or (ii) ownership of fifty percent (50%) or more of the
      outstanding shares, or (iii) beneficial ownership of such entity.

      "You" (or "Your") shall mean an individual or Legal Entity
      exercising permissions granted by this License.

      "Source" form shall mean the preferred form for making modifications,
      including but not limited to software source code, documentation
      source, and configuration files.

      "Object" form shall mean any form resulting from mechanical
      transformation or translation of a Source form, including but
      not limited to compiled object code, generated documentation,
      and conversions to other media types.

      "Work" shall mean the work of authorship, whether in Source or
      Object form, made available under the License, as indicated by a
      copyright notice that is included in or attached to the work
      (an example is provided in the Appendix below).

      "Derivative Works" shall mean any work, whether in Source or Object
      form, that is based on (or derived from) the Work and for which the
      editorial revisions, annotations, elaborations, or other modifications
      represent, as a whole, an original work of authorship. For the purposes
      of this License, Derivative Works shall not include works that remain
      separable from, or merely link (or bind by name) to the interfaces of,
      the Work and Derivative Works thereof.

      "Contribution" shall mean any work of authorship, including
      the original version of the Work and any modifications or additions
      to that Work or Derivative Works thereof, that is intentionally
      submitted to the Licensor for inclusion in the Work by the copyright owner
      or by an individual or Legal Entity authorized to submit on behalf of
      the copyright owner. For the purposes of this definition, "submitted"
      means any form of electronic, verbal, or written communication sent
      to the Licensor or its representatives, including but not limited to
      communication on electronic mailing lists, source code control systems,
      and issue tracking systems that are managed by, or on behalf of, the
      Licensor for the purpose of discussing and improving the Work, but
      excluding communication that is conspicuously marked or otherwise
      designated in writing by the copyright owner as "Not a Contribution."

      "Contributor" shall mean Licensor and any individual or Legal Entity
      on behalf of whom a Contribution has been received by Licensor and
      subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      copyright license to reproduce, prepare Derivative Works of,
      publicly display, publicly perform, sublicense, and distribute the
      Work and such Derivative Works in Source or Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      (except as stated in this section) patent license to make, have made,
      use, offer to sell, sell, import, and otherwise transfer the Work,
      where such license applies only to those patent claims licensable
      by such Contributor that are necessarily infringed by their
      Contribution(s) alone or by combination of their Contribution(s)
      with the Work to which such Contribution(s) was submitted. If You
      institute patent litigation against any entity (including a
      cross-claim or counterclaim in a lawsuit) alleging that the Work
      or a Contribution incorporated within the Work constitutes direct
      or contributory patent infringement, then any patent licenses
      granted to You under this License for that Work shall terminate
      as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
      Work or Derivative Works thereof in any medium, with or without
      modifications, and in Source or Object form, provided that You
      meet the following conditions:

      (a) You must give any other recipients of the Work or
          Derivative Works a copy of this License; and

      (b) You must cause any modified files to carry prominent notices
          stating that You changed the files; and

      (c) You must retain, in the Source form of any Derivative Works
          that You distribute, all copyright, patent, trademark, and
          attribution notices from the Source form of the Work,
          excluding those notices that do not pertain to any part of the
          Derivative Works; and

      (d) If the Work includes a "NOTICE" text file as part of its
          distribution, then any Derivative Works that You distribute must
          include a readable copy of the attribution notices contained
          within such NOTICE file, excluding those notices that do not
          pertain to any part of the Derivative Works, in at least one
          of the following places: within a NOTICE text file distributed
          as part of the Derivative Works; within the Source form or
          documentation, if provided along with the Derivative Works; or,
          within a display generated by the Derivative Works, if and
          wherever such third-party notices normally appear. The contents
          of the NOTICE file are for informational purposes only and
          do not modify the License. You may add Your own attribution
          notices within Derivative Works that You distribute, alongside
          or as an addendum to the NOTICE text from the Work, provided
          that such additional attribution notices cannot be construed
          as modifying the License.

      You may add Your own copyright statement to Your modifications and
      may provide additional or different license terms and conditions
      for use, reproduction, or distribution of Your modifications, or
      for any such Derivative Works as a whole, provided Your use,
      reproduction, and distribution of the Work otherwise complies with
      the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state otherwise,
      any Contribution intentionally submitted for inclusion in the Work
      by You to the Licensor shall be under the terms and conditions of
      this License, without any additional terms or conditions.
      Notwithstanding the above, nothing herein shall supersede or modify
      the terms of any separate license agreement you may have executed
      with Licensor regarding such Contributions.

   6. Trademarks. This License does not grant permission to use the trade
      names, trademarks, service marks, or product names of the Licensor,
      except as required for reasonable and customary use in describing the
      origin of the Work and reproducing the content of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
      agreed to in writing, Licensor provides the Work (and each
      Contributor provides its Contributions) on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
      implied, including, without limitation, any warranties or conditions
      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
      PARTICULAR PURPOSE. You are solely responsible for determining the
      appropriateness of using or redistributing the Work and assume any
      risks associated with Your exercise of permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
      whether in tort (including negligence), contract, or otherwise,
      unless required by applicable law (such as deliberate and grossly
      negligent acts) or agreed to in writing, shall any Contributor be
      liable to You for damages, including any direct, indirect, special,
      incidental, or consequential damages of any character arising as a
      result of this License or out of the use or inability to use the
      Work (including but not limited to damages for loss of goodwill,
      work stoppage, computer failure or malfunction, or any and all
      other commercial damages or losses), even if such Contributor
      has been advised of the possibility of such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
      the Work or Derivative Works thereof, You may choose to offer,
      and charge a fee for, acceptance of support, warranty, indemnity,
      or other liability obligations and/or rights consistent with this
      License. However, in accepting such obligations, You may act only
      on Your own behalf and on Your sole responsibility, not on behalf
      of any other Contributor, and only if You agree to indemnify,
      defend, and hold each Contributor harmless for any liability
      incurred by, or claims asserted against, such Contributor by reason
      of your accepting any such warranty or additional liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

      To apply the Apache License to your work, attach the following
      boilerplate notice, with the fields enclosed by brackets "[]"
      replaced with your own identifying information. (Don't include
      the brackets!)  The text should be enclosed in the appropriate
      comment syntax for the file format. We also recommend that a
      file or class name and description of purpose be included on the
      same "printed page" as the copyright notice for easier
      identification within third-party archives.

   Copyright [yyyy] [name of copyright owner]

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
```

---

## 十一、总结

本文档详细描述了**DevPilot**——一个AI驱动的全生命周期开发平台的完整设计方案。

### 核心特性

| 特性 | 描述 |
|------|------|
| 🤖 AI自主运行 | AI在后台自主执行任务，人类仅通过3个简单界面交互 |
| 🏠 本地运行 | 纯本地运行，数据不出机器，保护隐私 |
| 🌍 通用架构 | 支持任何编程语言和框架，通过适配器扩展 |
| 📦 开源免费 | Apache 2.0许可证，GitHub Public开源 |
| 🎯 极简交互 | 看板/进度/产品体验，三个界面覆盖全部需求 |

### 技术亮点

- **Electron + Vue 3**: 现代化跨平台桌面应用
- **BullMQ任务调度**: 专业级任务队列，支持优先级、重试、延迟
- **可插拔LLM引擎**: 支持OpenAI/Claude/Ollama/自定义API
- **多语言适配器**: Python/Java/Vue首发的可扩展适配器系统
- **完整DevOps**: 从需求到交付，端到端自动化

### 下一步

在获得确认后，将开始实施Phase 1: 基础框架搭建，包括：
1. 初始化PNPM Workspace
2. 创建Electron + Vue 3项目脚手架
3. 实现基础UI框架（三大界面骨架）
4. 集成SQLite数据库

---

**文档版本**: 1.0  
**创建日期**: 2024-01-15  
**最后更新**: 2024-01-15
