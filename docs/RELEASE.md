# 🚀 钱包管理器 - 自动发布指南

本文档说明如何使用 GitHub Actions 自动打包和发布钱包管理器的新版本。

## 📋 前置要求

1. **GitHub 仓库设置**
   - 确保项目已推送到 GitHub 仓库
   - 仓库需要启用 Actions 功能
   - 确保有仓库的写入权限

2. **版本管理**
   - 使用语义化版本号 (如: v1.0.0, v1.1.0, v2.0.0)
   - 版本号格式: `v主版本.次版本.修订版本`

## 🎯 发布方式

### 方式一：标签触发发布 (推荐)

1. **更新版本号**
   ```bash
   # 编辑 package.json 中的版本号
   # 编辑 src-tauri/tauri.conf.json 中的版本号
   ```

2. **提交更改**
   ```bash
   git add .
   git commit -m "chore: bump version to v1.0.0"
   ```

3. **创建并推送标签**
   ```bash
   # 创建标签
   git tag v1.0.0
   
   # 推送标签到远程仓库
   git push origin v1.0.0
   ```

4. **自动构建**
   - GitHub Actions 会自动检测到新标签
   - 开始多平台构建流程
   - 自动创建 GitHub Release

### 方式二：手动触发发布

1. **访问 GitHub Actions**
   - 进入仓库的 Actions 页面
   - 选择 "Release" 工作流

2. **手动运行**
   - 点击 "Run workflow" 按钮
   - 输入版本号 (如: v1.0.0)
   - 点击 "Run workflow" 确认

## 🏗️ 构建平台

自动构建支持以下平台：

| 平台 | 架构 | 输出文件 |
|------|------|----------|
| Windows | x64 | `.msi`, `.exe` |

## 📦 发布流程

1. **环境准备**
   - 安装 Node.js 和 Rust
   - 安装平台特定依赖
   - 缓存依赖以加速构建

2. **构建应用**
   - 安装前端依赖 (`yarn install`)
   - 构建 Tauri 应用
   - 生成各平台安装包

3. **创建发布**
   - 自动创建 GitHub Release
   - 上传所有平台的安装包
   - 生成发布说明

## 🔧 配置说明

### 工作流配置文件

位置: `.github/workflows/release.yml`

主要配置项：
- **触发条件**: 推送标签或手动触发
- **构建矩阵**: 多平台并行构建
- **权限设置**: 内容写入权限
- **缓存策略**: Rust 和 Node.js 依赖缓存

### 版本同步

确保以下文件中的版本号保持一致：
- `package.json` - 前端版本
- `src-tauri/tauri.conf.json` - Tauri 应用版本
- `src-tauri/Cargo.toml` - Rust 包版本

## 🚨 注意事项

1. **版本号格式**
   - 必须以 `v` 开头 (如: v1.0.0)
   - 遵循语义化版本规范

2. **构建时间**
   - Windows 构建需要 5-10 分钟

3. **权限要求**
   - 需要仓库的 Actions 权限
   - 需要创建 Release 的权限

4. **依赖管理**
   - 确保 `yarn.lock` 文件已提交
   - 避免在构建过程中修改依赖

## 🔍 故障排除

### 常见问题

1. **构建失败**
   - 检查版本号格式是否正确
   - 确认所有依赖都已正确安装
   - 查看 Actions 日志获取详细错误信息

2. **发布失败**
   - 确认 GitHub token 权限
   - 检查是否有重复的标签或发布

3. **平台特定问题**
   - **Windows**: 检查 Windows SDK 依赖

### 调试步骤

1. 查看 Actions 运行日志
2. 检查工作流配置语法
3. 验证仓库权限设置
4. 确认版本号和标签格式

## 📈 最佳实践

1. **版本管理**
   - 使用分支保护规则
   - 在发布前进行充分测试
   - 维护详细的变更日志

2. **自动化**
   - 设置自动化测试
   - 使用预发布版本进行测试
   - 配置通知机制

3. **安全性**
   - 定期更新依赖
   - 使用安全的构建环境
   - 验证发布包的完整性

## 📞 支持

如果在发布过程中遇到问题：
1. 查看 GitHub Actions 日志
2. 检查本文档的故障排除部分
3. 在仓库中创建 Issue 报告问题

---

**祝您发布顺利！** 🎉