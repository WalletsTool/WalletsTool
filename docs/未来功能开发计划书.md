# Web3钱包管理工具 - 未来功能开发计划书

## 项目概述

当前项目是一个基于Vue3 + Tauri的Web3多链钱包桌面应用，已实现EVM/Solana双生态批量转账、余额查询、链上监控等功能。规划新增Airdrop工具、CEX批量交易、DEX批量交易模块。

## 当前已实现功能

| 模块 | 功能 | 位置 |
|------|------|------|
| 转账 | 多对多批量转账、交易模拟防风控 | `src/features/ethereum/transfer/` |
| 余额查询 | 多链代币余额查询、Excel导出 | `src/features/ethereum/balance/` |
| 链上监控 | 钱包余额/Nonce监控 | `src/features/ethereum/monitor/` |
| 数据库 | SQLite 链/RPC/代币配置管理 | `src-tauri/src/database/` |
| 安全 | AES-256内存加密、零化删除、反调试 | `src-tauri/src/wallets_tool/security/` |

---

## 新功能规划

### 1. Airdrop工具 🆕

**定位**: 浏览器自动化 + Web3钱包批量交互DApp框架

#### 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                     Airdrop Framework                        │
├─────────────────────────────────────────────────────────────┤
│  Frontend (Vue 3)                                           │
│  ├── 脚本管理器 - 导入/编辑/删除 Playwright 脚本              │
│  ├── 账号管理器 - 导入钱包、绑定浏览器配置                     │
│  ├── 任务调度 - 批量任务编排、并发控制                        │
│  └── 执行监控 - 实时进度、日志回放                            │
├─────────────────────────────────────────────────────────────┤
│  Backend (Tauri/Rust)                                       │
│  ├── Playwright 进程管理 - 多浏览器实例并行                   │
│  ├── 钱包注入 - MetaMask / OKX Wallet 自动连接               │
│  ├── 脚本执行器 - 沙箱环境执行用户脚本                        │
│  └── 资源调度 - 内存/CPU限制、异常恢复                       │
└─────────────────────────────────────────────────────────────┘
```

#### 功能特性

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 浏览器配置 | 每个账号独立浏览器指纹（User-Agent、Canvas指纹） | 高 |
| 钱包注入 | MetaMask / OKX Wallet 自动 unlock + 连接 DApp | 高 |
| 脚本模板 | 预设常见交互模板（连接钱包、approve、swap等） | 高 |
| 任务编排 | 串行/并行执行、条件分支、循环 | 中 |
| 执行回放 | 视频录制、截图记录、错误定位 | 中 |
| 防检测 | 随机延迟、鼠标轨迹、Human-like行为 | 低 |

#### 目录结构

```
src/features/airdrop/
├── pages/
│   └── Airdrop.vue          # 主页面
├── components/
│   ├── ScriptManager.vue    # 脚本管理
│   ├── AccountManager.vue   # 账号管理
│   ├── TaskScheduler.vue    # 任务调度
│   └── ExecutionMonitor.vue # 执行监控
├── composables/
│   ├── usePlaywright.ts     # Playwright 控制
│   ├── useWalletInject.ts   # 钱包注入
│   └── useScriptEngine.ts   # 脚本引擎
└── styles/
    └── airdrop.css

src-tauri/src/wallets_tool/airdrop/
├── mod.rs
├── playwright_manager.rs    # 浏览器进程管理
├── wallet_injector.rs       # 钱包注入模块
├── script_executor.rs       # 脚本执行引擎
└── task_scheduler.rs        # 任务调度
```

#### 用户脚本API设计

```javascript
// 用户脚本示例
await dapp.connectWallet('metamask')           // 连接钱包
await dapp.approveToken('0x...', 'Infinity')   // 授权代币
await dapp.swap('ETH', 'USDC', 0.5)            // swap
await dapp.click('button.claim')               // 点击元素
await dapp.waitForSelector('.success')         // 等待元素
await dapp.screenshot()                        // 截图
```

---

### 2. CEX批量交易 🆕

**定位**: 主流交易所API批量操作（ccxt JS + Rust双后台）

#### 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                     CEX Trading Backend                      │
├─────────────────────────────────────────────────────────────┤
│  Layer 1: Frontend (Vue 3)                                  │
│  ├── 交易所配置 - API Key 管理                               │
│  ├── 账户信息 - 余额/持仓显示                                 │
│  ├── 交易面板 - 批量下单/撤单                                 │
│  └── 成交记录 - 历史查询                                      │
├─────────────────────────────────────────────────────────────┤
│  Layer 2: JavaScript Backend (ccxt)                         │
│  ├── 交易所适配器 - ccxt 统一接口                             │
│  ├── 实时行情 - 深度/最新价/K线                               │
│  └── 交易执行 - 下单/撤单/成交查询                            │
├─────────────────────────────────────────────────────────────┤
│  Layer 3: Rust Backend (Tauri)                              │
│  ├── API 密钥加密存储                                        │
│  ├── 请求签名 (HMAC/RSA)                                    │
│  ├── 限流控制 - 避免 API 限制                                │
│  └── 交易监控 - 成交推送、异常报警                            │
└─────────────────────────────────────────────────────────────┘
```

#### 支持交易所

| 交易所 | 支持状态 | API版本 | 备注 |
|--------|---------|----------|------|
| Binance | ✅ 计划 | Spot/Futures | 优先级最高 |
| OKX | ✅ 计划 | v5 | 支持Web3钱包 |
| Bybit | ✅ 计划 | v5 | |
| Coinbase | ✅ 计划 | - | |
| Kraken | ✅ 计划 | - | |
| Kucoin | ✅ 计划 | - | |
| Bitget | ✅ 计划 | - | |
| MEXC | ✅ 计划 | - | |

#### 功能特性

| 功能 | 描述 |
|------|------|
| 余额同步 | 聚合多交易所余额，统一展示 |
| 批量转账 | 交易所 → 钱包、钱包 → 交易所 |
| 批量交易 | 市价/限价批量下单，支持策略 |
| 三角套利 | 跨交易所价差监控（待定） |
| 网格交易 | 自动化网格策略（待定） |

#### 目录结构

```
src/features/cex-trading/
├── pages/
│   └── CexTrading.vue       # 主页面
├── components/
│   ├── ExchangeConfig.vue   # 交易所配置
│   ├── AccountOverview.vue  # 账户概览
│   ├── BatchOrder.vue       # 批量下单
│   └── TransferPanel.vue    # 转账面板
├── composables/
│   ├── useCcxt.ts           # ccxt 封装
│   └── useExchange.ts       # 交易所管理
└── styles/
    └── cex.css

src-tauri/src/wallets_tool/cex/
├── mod.rs
├── api_manager.rs           # API 管理
├── key_encryption.rs        # 密钥加密
├── rate_limiter.rs          # 限流控制
└── exchange/
    ├── binance.rs
    ├── okx.rs
    ├── bybit.rs
    └── ...
```

---

### 3. DEX批量交易 🆕 (低优先级)

**定位**: 去中心化交易所批量Swap，初期仅支持Aster / HyperLiquid

#### 支持计划

| DEX | 链 | 优先级 | 预计时间 |
|-----|-----|--------|---------|
| Aster | Ethereum L2 | 低 | 待定 |
| HyperLiquid | L1 | 低 | 待定 |

#### 功能范围

| 功能 | 描述 |
|------|------|
| 批量Swap | 多账号同时执行 Token Swap |
| 流动性操作 | 添加/移除流动性 |
| 限价单 | DEX 限价订单（视协议支持） |

---

### 4. Home页面改造

**目标**: 增加"工具箱"Tab，整合跨生态功能

#### UI变更

```vue
<a-tabs default-active-key="evm">
  <a-tab-pane key="evm" title="EVM">...</a-tab-pane>
  <a-tab-pane key="solana" title="Solana">...</a-tab-pane>
  <a-tab-pane key="tools" title="工具箱">  <!-- 新增 -->
    <div class="tools-grid">
      <div class="func-card" @click="goPage('airdrop')">
        <img src="avatar/optimized/airdrop.webp" />
        <h3>Airdrop工具</h3>
        <p>浏览器自动化 + 钱包批量交互DApp</p>
      </div>
      <div class="func-card" @click="goPage('cex-trading')">
        <img src="avatar/optimized/cex.webp" />
        <h3>CEX批量交易</h3>
        <p>主流交易所API批量操作</p>
      </div>
      <div class="func-card" @click="goPage('dex-trading')">
        <img src="avatar/optimized/dex.webp" />
        <h3>DEX批量交易</h3>
        <p>去中心化交易所批量Swap</p>
      </div>
    </div>
  </a-tab-pane>
</a-tabs>
```

#### funcList结构调整

```javascript
// 建议分组数据结构
const funcGroups = {
  evm: [
    { title: '多对多转账', pageName: 'transfer' },
    { title: '余额查询', pageName: 'balance' },
    { title: '链上监控', pageName: 'monitor' },
  ],
  solana: [
    // Solana功能待开发
  ],
  tools: [
    { title: 'Airdrop工具', pageName: 'airdrop', icon: '🤖' },
    { title: 'CEX批量交易', pageName: 'cex-trading', icon: '🏦' },
    { title: 'DEX批量交易', pageName: 'dex-trading', icon: '🔄' },
  ]
}
```

---

## 开发路线图

### Phase 1: 基础框架 (1-2周)

- [ ] Home页面增加"工具箱"Tab
- [ ] 路由配置 ( `/eth/airdrop`, `/eth/cex-trading`, `/eth/dex-trading` )
- [ ] 目录结构创建
- [ ] 基础UI框架搭建

### Phase 2: Airdrop工具 (4-6周)

- [ ] Playwright Rust绑定
- [ ] MetaMask / OKX Wallet注入模块
- [ ] 脚本执行引擎
- [ ] 账号管理界面
- [ ] 任务调度系统
- [ ] 监控与日志

### Phase 3: CEX批量交易 (3-4周)

- [ ] ccxt前端集成
- [ ] Rust后端密钥加密
- [ ] Binance API集成
- [ ] OKX API集成
- [ ] 批量下单界面
- [ ] 余额聚合展示

### Phase 4: DEX批量交易 (待定)

- [ ] Aster协议集成
- [ ] HyperLiquid协议集成
- [ ] 批量Swap界面

---

## 依赖变更

| 类型 | 依赖 | 用途 |
|------|------|------|
| 新增 (JS) | `ccxt` | CEX API 统一接口 |
| 新增 (JS) | `playwright` | 浏览器自动化 |
| 新增 (Rust) | `tokio` | 异步任务调度 |
| 新增 (Rust) | `ccxt-rs` (待查) | Rust后端CEX支持 |

---

## 风险与注意事项

1. **CEX API安全**
   - API Key必须加密存储于Rust后端
   - 禁止在前端日志中暴露密钥

2. **Airdrop防检测**
   - 需实现Human-like行为模式
   - 随机延迟、鼠标轨迹、Canvas指纹混淆

3. **资源限制**
   - Playwright浏览器实例需要内存限制
   - 单机最大并发数需要压力测试

---

## 已实现功能清单

### 基础模块
- 本地数据库同步（SQLite）
- RPC管理（本地数据库）
- 代币管理（本地数据库）
- 导入发送和接收方（文本粘贴、Excel导入）
- 转账代币选择
- 转账数量设置（全部、随机范围、查询余数）
- 转账频率设置（随机间隔、自动）
- Gas设置（Limit、Price、最大值）

### 转账功能
- 查询平台币余额
- 查到账地址
- 中途停止
- 筛选表格数据
- 导出查询结果
- 支持同配置多开

### 余额查询功能
- 多链余额查询
- 数据筛选
- 多线程查询

### 数据库管理
- 链配置管理
- RPC提供商管理
- 代币配置管理

### 安全模块
- AES-256内存加密存储私钥
- 零化删除（Zeroize on drop）
- 运行时反调试检测（Windows IsDebuggerPresent）
- SHA-256完整性校验
- 会话密钥管理

---

## 开发时间线

### 第一阶段（1-2周）
- Home页面"工具箱"Tab改造
- 基础路由和目录结构

### 第二阶段（4-6周）
- Airdrop工具开发
- Playwright集成
- 钱包注入模块

### 第三阶段（3-4周）
- CEX批量交易开发
- ccxt集成
- 多交易所API支持

### 第四阶段（待定）
- DEX批量交易开发
- Aster/HyperLiquid集成

---

## 风险评估

### 高风险项目
1. **Airdrop工具**: 浏览器自动化资源消耗大，需要做好沙箱隔离
2. **CEX API集成**: 密钥安全是核心，需要严格加密
3. **Playwright内存管理**: 多实例并发可能导致内存溢出

### 中风险项目
1. **多交易所兼容**: 各交易所API差异需要详细适配
2. **脚本执行引擎**: 用户脚本安全性需要验证
3. **跨平台兼容**: Windows/macOS/Linux 行为差异

### 低风险项目
1. **界面优化**: 用户体验改进
2. **DEX支持**: 优先级低，热度变化可能调整
3. **日志系统**: 技术难度较低

---

## 成功指标

### 功能指标
- [ ] Airdrop工具支持MetaMask/OKX Wallet双钱包
- [ ] CEX支持至少5家主流交易所
- [ ] DEX支持Aster/HyperLiquid（按需）
- [ ] 单机支持50+并发浏览器实例

### 安全指标
- [ ] CEX API Key零泄露
- [ ] 私钥内存加密
- [ ] 脚本沙箱执行隔离

### 性能指标
- [ ] Airdrop单账号交互 < 30秒
- [ ] CEX批量下单 < 5秒/100账号
- [ ] 内存使用 < 2GB（50并发）

---

## 总结

本计划书整合了Airdrop工具、CEX批量交易、DEX批量交易三大新模块的完整规划。采用ccxt实现JS层CEX集成，Rust层负责密钥加密和安全控制。Airdrop工具基于Playwright浏览器自动化框架，支持MetaMask和OKX Wallet双钱包注入。DEX初期仅支持Aster/HyperLiquid，按热度调整优先级。建议按Phase 1-4顺序实施，确保基础框架稳定后再开发高级功能。
